# multi-module-service

# Многомодульная служба для выполнения различных функций в отдельных модулях

# Версия 2.0.0

Данная версия написана на Go взамен реализации на python: weather-mqtt-publisher

## Обзор
Проект **multi-module-service** предназначен для выполнения различных функций:
 * модуль мониторинга температуры в реальном времени с использованием API Open-Meteo. Скрипт получает текущие данные о погоде и публикует эти значения в топики MQTT.

## Начало на Go
### Установка Go SDK
Зайдите на сайт https://golang.org/doc/install и скачайте установочный файл для вашей операционной системы. Следуйте инструкциям на странице для установки Go. После установки вы сможете запускать и собирать приложения Go из командной строки.

## Быстрый запуск
Для быстрой компиляции и запуска приложения выполните команду:
```bash
go run main.go
```
Для запуска и компиляции всех файлов лучше выполнять в каталоге приложения:
```bash
go run .
```
Эти команды скомпилирует и выполнит приложение в одном шаге.

Взглянуть версию:
```bash
go run . -version
```

## Сборка
Если вы хотите создать исполняемый файл приложения, используйте команду:
* **Для Linux**
```bash
go build -o multi-module-service
```
* **Для Windows**
```bash
go build -o multi-module-service.exe
```

## Кросс-компиляция
### Кросс-компиляция из Windows под Linux

#### 1. Установка переменных окружения через PowerShell
В PowerShell вы можете установить переменные окружения. Например, чтобы установить `GOOS` и `GOARCH` для кросс-компиляции:

```powershell
$env:GOOS="linux"
$env:GOARCH="amd64"
```

Эти переменные указывают, что Go должен собирать программу для операционной системы Linux с архитектурой 64-бит.

#### 2. Компиляция с помощью PowerShell
После того как переменные окружения установлены, можно запустить команду для компиляции:

```powershell
go build -o ./bin/mainapp-linux ./cmd/mainapp
```

Эта команда соберет ваш Go-проект и создаст исполнимый файл `mainapp-linux`, который будет предназначен для Linux.

#### Объяснение:
- **`-o ./bin/mainapp-linux`**: Указывает полный путь и имя выходного файла.
- **`./cmd/mainapp`**: Указывает путь к пакету (или к файлу), который нужно скомпилировать.
  Собранный бинарник будет находиться в папке `./bin/`. Имя бинарного файла — `mainapp-linux`.

#### 3. Удаление переменных окружения (по необходимости)
Если вы хотите сбросить настройки для других сборок, вы можете просто закрыть текущую сессию PowerShell или установить новые значения переменных:

```powershell
$env:GOOS="windows"
$env:GOARCH="amd64"
```

#### Использование CMD
- Если вы используете **обычную командную строку (CMD)**, то синтаксис установки переменных будет немного отличаться:

  ```cmd
  set GOOS=linux
  set GOARCH=amd64
  go build -o ./bin/mainapp-linux ./cmd/mainapp
  ```

## Структура проекта

multi-module-service/  
├── cmd/  
│   └── mainapp/        # Основное приложение  
│       └── main.go  
├── modules/  
│   ├── mqttclient/     # Модуль MQTT клиента  
│   │   └── README.md  
│   └── weather/        # Модуль для получения погодных данных  
│       └── README.md  
└── README.md           # Общий обзор проекта

Каждый модуль имеет собственный README.md, где указаны зависимости, конфигурации и инструкции по использованию для конкретного модуля.

## Требования
* Go 1.20+
* Библиотека net/http для запросов к API
* Библиотека paho.mqtt.golang для коммуникации MQTT

## Установка библиотек

Установите необходимые библиотеки с помощью команды:
```bash
go mod init main
go get github.com/eclipse/paho.mqtt.golang
```

## Настройка

- В файле кода укажите широту и долготу для получения точных данных о погоде для вашего местоположения.
- Настройте адрес и порт брокера MQTT.

## Использование

Соберите и запустите программу с помощью команды:

```bash
go run main.go
```

## Топики MQTT

По умолчанию используемые топики:
- температура за бортом **temperature/CurrentOutdoor**

## Автозапуск

Чтобы программа запускалась автоматически, создайте systemd-службу (Linux):
1. Добавьте файл **multi-module-service.service** в директорию /etc/systemd/system/ и укажите путь к исполняемому файлу приложения.
2. Убедитесь, что исполняемый файл программы доступен и имеет соответствующие права:
```bash
sudo chmod +x multi-module-service
```
3. Обновите список служб systemctl:
```bash
sudo systemctl daemon-reload
```
4. Активируйте и запустите эту службу:
```bash
sudo systemctl enable multi-module-service
sudo systemctl start multi-module-service
```
5. Проверьте состояние службы:
```bash
sudo systemctl status multi-module-service
```
## Использование флагов командной строки

Программа `multi-module-service` поддерживает несколько флагов командной строки, которые позволяют управлять поведением программы при запуске.

### Доступные флаги

#### `-version`
Показывает текущую версию программы и завершает выполнение.

**Пример использования:**
```bash
multi-module-service -version
```
